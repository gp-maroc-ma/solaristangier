version: 1
frontend:
  phases:
    preBuild:
      commands:
        - source .env-production # env variables for production branch AWS Amplify deploy
        - curl -L -o hugo.tar.gz https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_Linux-64bit.tar.gz
        - tar -xf hugo.tar.gz
    build:
      commands:
        - source .env-production # env variables for production branch AWS Amplify deploy
        - GIT_TAG=$(git tag --list | tail -n 1 || echo "0.0.0")
        - sed -i "s/deployed_git_tag = \".*\"/deployed_git_tag = \"${GIT_TAG}\"/" config/production-amplify/params.toml
        - ./hugo version
        - ./hugo --gc --minify --baseURL ${BASE_URL} --environment ${HUGO_ENVIRONMENT} # Edit Amplify-specific parameters in config/production-amplify/params.toml
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
